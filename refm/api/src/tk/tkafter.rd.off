# $Id: tkafter.rd,v 1.10 2000/03/08 15:58:39 arai Exp $
# Class TkAfter is defined in tkafter.rb
=begin
= TkAfter

((-キ札好ュスメ、ャイキ、、。「ヘラコニトエココ。」ニテ、ヒーΕ劵┘蝓▲院♪鯛離-))

((-ID、ャ2シ俥Α屐♪Ε曄▲魅侫織Ε曄▲辧▲院♪「after_id -> "after#N"。「 ID -> "aNNNN"-))

サリト愁茱ミイ盧螟゛、ソ、マ・ケ・ッ・Д蕁Ε諭▲磧Α屐Α◆Ε痢瀬茵▲辧▲蓮▲董▲宗▲諭▲紂▲劵告哨張吋筺▲
、Ε宗≒Ε曄Ε叩鬣ケ、ヌ、ケ。」

ーハイシ、マ5ノテエヨウヨ、ヌ3イ償縫好轡、ケ、

  require "tk"

  TkAfter.new(5 * 1000, 3, proc { p Time.now.asctime }).start
  Tk.mainloop

・ヌ・ク・ソ・愁蕁▲曠

  require "tk"

  v = TkVariable.new(Time.now.asctime)
  TkAfter.new(1 * 1000, -1, proc { v.value = Time.now.asctime }).start

  TkLabel.new {
    textvariable v
    pack
  }
  Tk.mainloop

セ蠏ュ・ヌ・ク・ソ・愁蕁▲沺「(('xclock -digital -update 1')) 、隍熙簑オウホ、ヌ、マ、「、
、゛、サ、」、キ、ォ、キ。「ーハイシ、隍熙マ((*・゛・キ*))、ハ、隍ヲ、ヌ、ケ。」

  require "tk"

  v = TkVariable.new(Time.now.asctime)
  Thread.new {
    loop do
      v.value = Time.now.asctime
      sleep 1
    end
  }

  TkLabel.new {
    textvariable v
    pack
  }
  Tk.mainloop

=end
###・ケ・ッ・Д蕁Ε諭▲礇廷Ε紂▲院▲隋♪Ε曄▲漫ΕΑ皈Д
###
###・「・ハ・А璽汽蕁▲曠
###
###  require "tk"
###
###  s_line = m_line = h_line = nil
###  canvas = TkCanvas.new {
###    width 200
###    height 200
###    s_line = TkcLine.new(self, 0, 0, 0, 0, {"width"=>3})
###    m_line = TkcLine.new(self, 0, 0, 0, 0, {"width"=>4})
###    h_line = TkcLine.new(self, 0, 0, 0, 0, {"width"=>5})
###  }.pack
###
###  sec = {}
###  min = {}
###  hour = {}
###  60.times do |i|
###    dx = Math.cos(2 * Math::PI * (i.to_f-15) / 60)
###    dy = Math.sin(2 * Math::PI * (i.to_f-15) / 60)
###    sec[i] = [100 + dx * 90, 100 + dy * 90]
###    min[i] = [100 + dx * 70, 100 + dy * 70]
###    24.times do |j|
###      dx = Math::cos(2 * Math::PI * ((j%12+i.to_f/60)-3)/12)
###      dy = Math::sin(2 * Math::PI * ((j%12+i.to_f/60)-3)/12)
###      hour[[j, i]] = [100 + dx * 60, 100 + dy * 60]
###    end
###  end
###
###  tick = proc do
###    now = Time.now
###    s_line.coords 100, 100, *sec[now.sec]
###    m_line.coords 100, 100, *min[now.min]
###    h_line.coords 100, 100, *hour[[now.hour, now.min]]
###  end
###
###  tick.call
###  TkAfter.new(1 * 1000, -1, tick).start
###
###  Tk.mainloop
=begin

== ・ケ。シ・ム。シ・ッ・鬣ケ:

((<Object>))

== ・、・Д叩シ・ノ、キ、ニ、、、тД・蝪シ・

((<TkCore>))

== extend、キ、ニ、、、тД・蝪シ・

((<TkCore>))

== ・ッ・鬣ケ・皈ス・テ・ノ:

--- TkAfter.callback(arg)
    ー(|arg|))、ヌサリト熙キ、ソID((-aNNNN-))、ヒツミアケ、ДΑシ・Д漾Ε董Ε奪┘螢償哨張吋筺▲
    、゛、ケ。」

--- TkAfter.info
    シツケヤツヤ、チ、ヒ、ハ、テ、ニ、、、kAfter・ェ・ヨ・ク・ァ・ッ・ネ、疋蹈棡Ε辧▲、ニハヨ、キ、゛、ケ。」

      require "tk"

      TkAfter.new(1 * 1000, 1, proc {puts "do callback (ruby/tk)"}).start
      p TkAfter.info

      Tk.mainloop

      => [#<TkAfter: ...>]
         do callback (ruby/tk)

    Tcl/Tk、ヌトセタワナミマソ、オ、Ε宗ΕΑシ・Д漾Ε董Ε奪┘螢償Ε磧◆屐‡Ε漾▲后▲((<TkAfter#after_id>))、簓ロホ
    、ヒエ゛、゛、Α、ケ。」

    ((-、チ、遉テ、ネホ网ャハ」サィ。ゥ-))

      require "tk"

      TkCore::INTERP._eval "after 1000 {puts {callback executing (tcl/tk)}}"
      TkAfter.new(1 * 1000, 1, proc {puts "callback executing (ruby/tk)"}).start
      p TkAfter.info
      Thread.new {
        sleep 5
        p TkAfter.info
      }

      Tk.mainloop

      => [#<TkAfter: ... >, "after#1"]
         callback executing (tcl/tk)
         callback executing (ruby/tk)
         []

--- TkAfter.new(interval=nil, loop_exec=nil, *procs])
    (({TkAfter}))・ェ・ヨ・ク・ァ・ッ・ネ、促タョ、キ、゛、ケ。」ーΕ礇悒宗▲、鬢Ε愁侍試「
    ((<TkAfter#set_procs>))、肇◆▲ーΕ魅ニ、モスミ、キ、゛、ケ。」

== ・皈ス・テ・ノ:

--- TkAfter#do_callback(*args)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償恢(|args|))、妊沺▲、ニシツケヤ、キ、゛、ケ。」

--- TkAfter#set_callback(sleep, args=nil)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償妊潺泪宗▲、゛、ケ。」

--- TkAfter#set_next_callback(*args)

--- TkAfter#after_id
    TkAfter、ホ・ウ。シ・Д漾Ε董Ε叩哨▲魯奸▲院♪魅サTcl/Tk・ウ・゛・Д(({after}))、ホフ皃
    テヘ)、魅茵▲、゛、ケ。」

--- TkAfter#after_script
    ・ウ。シ・Д漾Ε董Ε奪┘螢償魅茵▲、゛、ケ。」Tcl・ケ・ッ・Д蕁Ε諭▲漫▲院」

--- TkAfter#current_proc
    シツケヤツヤ、チ、ホ(({Proc}))・ェ・ヨ・ク・ァ・ッ・ネ、魅茵▲、゛、ケ。」

--- TkAfter#current_sleep
    タ゜ト熙キ、ソシツケヤツヤ、チサヨ、魅茵▲、゛、ケ(シツケヤ、゛、ヌ、ホサト、愁茵▲漫▲沺◆屐♯Α、サ、。」

--- TkAfter#loop_exec

--- TkAfter#loop_exec = val

--- TkAfter#get_procs

--- TkAfter#current_status
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曠札茵疋蹈棡Ε辧▲、ニハヨ、キ、゛、ケ。」ヌロホΕ曠悒薀船漫▲泪克Ε

    *・ソ・、・゛、ホセヨ

     ((<TkAfter#running?>))、ホフ皃泥悄」 start、キ、ニ、、、Ε(({true}))。「ト莉゜、キ、ニ、、、Ε
     (({false}))。」
    *ツヤ、チサヨ

     タ゜ト熙キ、ソツヤ、チサヨ。」
    *(({Proc}))・ェ・ヨ・ク・ァ・ッ・ネ

     ナミマソ、キ、ソ・ウ。シ・Д漾Ε董Ε奪┘螢償」
    *ー

     ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε劵淵沺▲院綬Ε曠魅蹈棡」
    *サト、哨張吋筌

     ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曠汽函♯哨張吋筌

    、ヌ、ケ。」

--- TkAfter#cancel_on_exception?

--- TkAfter#cancel_on_exception=(mode)

--- TkAfter#running?
    ・ソ・、・゛、ャシツケヤ、オ、Ε法◆◆▲蓮◆▲侍試「、゛、ソ、マサリト期憎Ε劵福廖▲、ソセ試Ε
    (({false})) 、魅茵▲、゛、ケ。」、ス、殴魯Α次▲漫▲(({true}))、魅茵▲、゛、ケ。」

--- TkAfter#loop_rest
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曠汽函♯哨張吋筌憎魅茵▲、゛、ケ。」

--- TkAfter#loop_rest=(rest)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曠汽函♯哨張吋筌憎(|rest|))、ヒ、キ、゛、ケ。」

--- TkAfter#set_procs(interval, loop_exec, *procs)
    ((|interval|))エヨウヨ、ヌ((|loop_exec|))イ哨張吋筺▲院({Proc}))・ェ・ヨ・ク・ァ・ッ・ネ
    ((|procs|))、妊潺泪宗▲、゛、ケ。」(({Proc}))・ェ・ヨ・ク・ァ・ッ・ネ、マハ」ソ妊潺泪宗▲漫▲紂◆、ケ。」

    ((|interval|))、マ。「"idle"。「ソ泥悄◆、ソ、マソ泥悄魅茵▲(({Proc}))・ェ・ヨ・ク・ァ・ッ・ネ、ヌ、ケ。」
    ソ泥悄▲沺▲后▲曠償泥(・゜・縫)エヨウヨ、ヌ・ウ。シ・Д漾Ε董Ε奪┘螢償哨張吋筺▲院♪ΕΑ▲諭殴罐奸廖▲、゛、ケ。」

    ((|loop_exec|))、マ。「・ウ。シ・Д漾Ε董Ε奪┘螢(|procs|))、ホシツケヤイ憎憎泥悄▲魅汽螢飛Ε
    、゛、ケ。」-1、ヌ。「・ウ。シ・Д漾Ε董Ε奪┘螢償哨張吋筺▲ツウ、ア、゛、ケ。」

    ((|loop_exec|)) > 0 、ヌ。「サリト期憎Ε拭▲▲轡張吋筺▲、゛、ケ。」サリト期憎哨張吋筌螟マ・、・Д
    ・ソ・Д院皈ス・テ・ノ((<TkAfter#running?>))、マ(({false}))、魅茵▲院隍ヲ、ヒ、ハ、熙゛、ケ。」

--- TkAfter#add_procs(*procs)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε((|procs|))、謄離ぅ董▲、゛、ケ。」((|procs|))、マ(({Proc}))・ェ・ヨ
    ・ク・ァ・ッ・ネ、゛、ソ、マ((-、ハ、ヒ。ゥ-))、ヌ、ケ。」

--- TkAfter#set_start_proc(sleep, init_proc, *init_args)
    ー(|sleep|))、マ。「ソ泥(・゜・縫)、゛、ソ、マハクサ"idle"))、ヌ、ケ。」

--- TkAfter#start(*init_args)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償(|init_args|))、恢Ε劵轡張吋筺▲院♪隍ヲ・ケ・ア・ク・蝪シ・Ε、゛
    、ケ。」

    ーΕ曄璽罐奸廖▲泪克Ε

    *コヌス鬢ホツヤ、チサヨ
    *・ウ。シ・Д漾Ε董Ε奪┘螢
    *・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曄綬
    *キォ、魅茵▲サホツヤ、チサヨ
    *キォ、魅茵▲サホ・ウ。シ・Д漾Ε董Ε

     セハホャサマコヌス鬢ホ・ウ。シ・Д漾Ε董Ε奪┘螢償好、魅茵▲、゛、ケ
    *キォ、魅茵▲サホー

     セハホャサマーΕ蓮▲、ヌ、ケ。」

    、ヌ、ケ。」

--- TkAfter#restart(*restart_args)
    ・ウ。シ・Д漾Ε董Ε奪┘螢償璽縫轡張吋筺▲、゛、ケ。」

--- TkAfter#cancel
--- TkAfter#stop
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曄Ε院Ε◆Ε・蝪シ・捺宗、キ、゛、ケ。」

--- TkAfter#continue(wait=nil)
    ト莉゜、キ、ソ・ウ。シ・Д漾Ε董Ε奪┘螢償璽縫Ε、キ、゛、ケ。」ー(|wait|))、愁螢飛Ε院♪ΕΑ▲諭▲魅張
    、チサヨ、璽縫拭ト熙ケ、ΕΑ▲諭▲磧▲漫▲紂◆、ケ

--- TkAfter#skip
    ・ウ。シ・Д漾Ε董Ε奪┘螢償Ε曠轡張吋筺怪妊襯侫サΕ、゛、ケ。」

--- TkAfter#info
    [ID, シ魅]、ヌ、「、疋蹈棡魅茵▲、゛、ケ。」

    ID、マ。「((<TkAfter#after_id>))、ャハヨ、ケID、ヌ、マ、ハ、ッ。「(({TkAfter}))ニ篷Ε
    エノヘキ、ニ、、、哨▲魯侫侫((-aXXXX-))、ヌ、ケ。」

    シ魅奸▲沺Ε宗Α◆Α、ホシ魅奸▲漫「ーハイシ、ホハクサ期愁螢飛Ε、゛、ケ。」

    *"timer"

     サリト愁茱螟ヒ・ウ。シ・Д漾Ε董Ε叩哨張吋筺▲院♪隍ヲ、ヒサリト熙オ、Ε法◆◆▲愁侍
    *"idle"

     ・「・、・ノ・瀬茵▲辧▲蓮▲董▲宗▲諭▲紂▲劵轡張吋筺▲院♪隍ヲサリト熙オ、Ε法◆◆▲愁侍

== ト

--- TkAfter::Tk_CBID
    ・ウ。シ・Д漾Ε董ΕID、ホ・ォ・ヲ・Д宗▲漫▲院」(({Tk_CBID}))、マヌロホΕ漫▲院▲0ネヨフワ、ホヘラチヌ、キ、ォ
    サネ、Ε法◆◆◆、サ、」Ruby、ホト憎Ε礇謄悄魅爛吋院▲漫▲紂▲蓮◆◆▲宗≒Ε漫▲院」

--- TkAfter::Tk_CBTBL
    {・ウ。シ・Д漾Ε董Ε奪┘螢償ΕID => TkAfter・ェ・ヨ・ク・ァ・ッ・ネ}、ヌ、「、Д沺Ε董Ε・螟ヌ、ケ。」

=end
