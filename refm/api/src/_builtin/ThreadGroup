= class ThreadGroup < Object

スレッドグループを表すクラスです。グループに属する [[c:Thread]] をまとめて
操作できます。

[[c:Thread]] は必ずいずれかひとつのスレッドグループに属します。
生成されたばかりの Thread は、生成した Thread のグループを引き継ぎます。
メインスレッドはデフォルトでは [[m:ThreadGroup::Default]] に属します。

: 例:

生成したすべてのThreadが終了するのを待つ

    5.times {
       Thread.new { sleep 1; puts "#{Thread.current} finished" }
    }
    
    (ThreadGroup::Default.list - [Thread.current]).each {|th| th.join}
    
    puts "all threads finished"

対象の Thread が Thread を起こす可能性がある場合
([[m:Thread.exclusive]]参照)

    Thread.exclusive do
      (ThreadGroup::Default.list - [Thread.current]).each {|th| th.join}
    end

=== ThreadGroup#freeze と ThreadGroup#enclose の違い

どちらのメソッドでも [[m:ThreadGroup#add]] によるスレッドの追加ができなくなる点は同じですが、
[[m:Thread.new]] に関して違いがあります。現在のスレッドが属する ThreadGroup が freeze 
されている場合、Thread.new{ ... } はエラーになります。ThreadGroup が enclose されているだけでは、
Thread.new{ ... } はエラーになりません。生成されたスレッドは従来通り 親スレッドの ThreadGroup に属します。

== Class Methods

--- new    -> ThreadGroup

新たな ThreadGroup を生成して返します。

#@samplecode 例
thread_group = ThreadGroup.new
thread_group.add Thread.new { sleep 0.1; Thread.new { sleep 1 }; sleep 1 }
thread_group.add Thread.new { sleep 2 }
sleep 0.5
thread_group.list # => [#<Thread:0x007fc6f1842d70 sleep>, #<Thread:0x007fc6f1842c80 sleep>, #<Thread:0x007fc6f080dba8 sleep>]
#@end

== Instance Methods

--- add(thread)    -> self

スレッド thread が属するグループを自身に変更します。

@param thread 自身に加えたいスレッドを指定します。

@raise ThreadError 自身が freeze されているか enclose されている場合に、発生します。また引数 thread が属する ThreadGroup が freeze されているか enclose されている場合にも発生します。

#@samplecode 例
puts "Initial group is #{ThreadGroup::Default.list}"
# => Initial group is [#<Thread:0x4a49168 run>]

tg = ThreadGroup.new
t1 = Thread.new { sleep }
t2 = Thread.new { sleep }
puts "t1 is #{t1}" # => t1 is #<Thread:0x50bef60>
puts "t2 is #{t2}" # => t2 is #<Thread:0x50beed0>
tg.add(t1)
puts "Initial group now #{ThreadGroup::Default.list}"
# => Initial group now [#<Thread:0x3039168 run>, #<Thread:0x50beed0 run>]
puts "tg group now #{tg.list}"
# => tg group now [#<Thread:0x50bef60 run>]
#@end

--- enclose    -> self

自身への [[m:ThreadGroup#add]] によるスレッドの追加・削除を禁止します。
enclose された ThreadGroup に追加や削除を行うと例外 [[c:ThreadError]] が発生します。

ただし、[[m:Thread.new]] によるスレッドの追加は禁止されません。enclose されたスレッドグループ A に
属するスレッドが新たにスレッドを生成した場合、生成されたスレッドはスレッドグループ A に属します。

追加の例:

  thg = ThreadGroup.new.enclose
  thg.add Thread.new {}

  => -:2:in `add': can't move to the enclosed thread group (ThreadError)

削除の例:

  thg1 = ThreadGroup.new
  thg2 = ThreadGroup.new

  th = Thread.new {sleep 1}

  thg1.add th
  thg1.enclose
  thg2.add th

  => -:8:in `add': can't move from the enclosed thread group (ThreadError)

--- enclosed?    -> bool

自身が enclose されているなら true を返します。そうでないなら false を返します。デフォルトは false です。

freeze された ThreadGroup には Thread の追加/削除ができませんが、enclosed? は false を返します。

    thg = ThreadGroup.new
    p thg.enclosed?         # => false
    thg.enclose
    p thg.enclosed?         # => true

    thg = ThreadGroup.new
    p thg.enclosed?         # => false
    thg.freeze
    p thg.enclosed?         # => false

@see [[m:ThreadGroup#enclose]]
--- list    -> [Thread] 

self に属するスレッドの配列を返します。
version 1.8 では、aborting 状態であるスレッド
も要素に含まれます。つまり「生きている」スレッドの配列を返します。

#@samplecode 例
ThreadGroup::Default.list   # => [#<Thread:0x00007f8f13867078 run>]
#@end

== Constants

--- Default -> ThreadGroup

デフォルトで定義されている [[c:ThreadGroup]] です。メインスレッド
は最初このグループに属します。
